#!/usr/bin/env python3

import sys
import math
import time
import random

def miller_rabin(n, k=5):
    if n < 2: return False
    for p in [2,3,5,7,11,13,17,19,23,29]:
        if n % p == 0: return n == p
    s, d = 0, n-1
    while d % 2 == 0:
        s, d = s+1, d//2
    for _ in range(k):
        a = random.randrange(2, n-1)
        x = pow(a, d, n)
        if x == 1 or x == n-1: continue
        for _ in range(s-1):
            x = pow(x, 2, n)
            if x == n-1: break
        else:
            return False
    return True

def find_factors(n):
    if n % 2 == 0: return 2, n//2
    for i in range(3, int(math.isqrt(n)) + 1, 2):
        if n % i == 0:
            if miller_rabin(i) and miller_rabin(n//i):
                return i, n//i
    return None

def factorize(filename):
    with open(filename, 'r') as file:
        n = int(file.readline().strip())
    
    start_time = time.time()
    factors = find_factors(n)
    end_time = time.time()
    
    if factors:
        p, q = factors
        print(f"{n}={p}*{q}")
    else:
        print(f"Unable to factor {n} within the time limit.")
    
    print(f"Time taken: {end_time - start_time:.2f} seconds")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: ./rsa <filename>")
        sys.exit(1)
    
    factorize(sys.argv[1])
